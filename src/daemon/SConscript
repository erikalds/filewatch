import os

Import('env rpclib')

env = env.Clone()

env.Tool("catch_test")

env.AppendUnique(CXXFLAGS=['-pthread'])
cppfiles = env.Glob("*.cpp") +\
           env.Glob(os.path.join("unittest", "*.cpp"))

env.AppendUnique(LINKFLAGS=['-pthread'])
env.AppendUnique(LIBS=[rpclib, "grpc++", "protobuf", "pthread", "stdc++fs"])
daemon = env.Program("fwdaemon", source=cppfiles)

testresult = env.CatchTest("testreport.txt", daemon)

Return('daemon')
